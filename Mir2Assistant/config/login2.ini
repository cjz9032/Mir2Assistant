

FState.TFrmDlg.DLoginOkClick
0059BDF4        push        ebp
0059BDF5        mov         ebp,esp
0059BDF7        add         esp,0FFFFFFF4
0059BDFA        mov         dword ptr [ebp-0C],ecx
0059BDFD        mov         dword ptr [ebp-8],edx
0059BE00        mov         dword ptr [ebp-4],eax
0059BE03        mov         eax,[0067A23C];^gvar_007524C0:TLoginScene
0059BE08        mov         eax,dword ptr [eax]
0059BE0A        call        0056C488
0059BE0F        mov         esp,ebp
0059BE11        pop         ebp
0059BE12        ret         4


通过往下找lowercase 那长的, 直接赋值 loginid和passwd
,[0067A728];^gvar_0074350C:TFrmDlg
0056A86E        mov         eax,[0067A728];
0056A873        mov         eax,dword ptr [eax]
0056A875        mov         eax,dword ptr [eax+8D4]
0056A87B        mov         eax,dword ptr [eax+27C]

len = [[[[0067A728]]+8D4]+27C]-4 //  04 00 00 00 int32的4
unicode adad
61 00 64 00  a.d.
61 00 64 00  a.d.


; 0056A958        cmp         al,9
; 0056A95A>       jne         0056A976
; 0056A95C        mov         eax,dword ptr [ebp-8]
; 0056A95F        mov         word ptr [eax],0
; tab focus
mov         eax,[0067A728]
mov         eax,dword ptr [eax]
mov         eax,dword ptr [eax+8D4]
call        0053F430
mov         eax,[0067A728]      
mov         eax,dword ptr [eax] 
mov         eax,dword ptr [eax+8D4] 
mov         eax,dword ptr [eax+27C] 

mov         dword ptr [eax-4], 4 

mov         word ptr [eax], 61 
mov         word ptr [eax+2], 64
mov         word ptr [eax+4], 61
mov         word ptr [eax+6], 64
mov         word ptr [eax+8], 0  

0056A891        mov         eax,[0067A728];^gvar_0074350C:TFrmDlg
0056A896        mov         eax,dword ptr [eax]
0056A898        mov         eax,dword ptr [eax+8D8]
0056A89E        mov         edx,dword ptr [eax+27C]









ZC.H+145189          - 0019F97C,ZC.H+145D37,0019FA88,0019FAA8,...
ZC.H+142A82          - 02ED7990,00320074,0019FB0C,02F90FC0,...
ZC.H+23B26F          - 0019FCD8,ZC.H+23BB36,0019FAFC,02ED7990,...
ZC.H+7C145           - 02ED7901,ZC.H+7C197,ZC.H+70061,0019FC58,...
ZC.H+7C197           - ZC.H+70061,0019FC58,ZC.H+236004,0019FD08,...
ZC.H+7C1BF           - 02ED7990,0019FD08,ZC.H+75F1F,02920FC8,...
ZC.H+75F1F           - 02920FC8,00000102,0019FD08,MSCTF.HasDeferredInputForCoreDispatcher+9A,...


_Unit22.TWinControl.WMChar
0047C1B0        push        ebx
0047C1B1        push        esi
0047C1B2        mov         esi,edx
0047C1B4        mov         ebx,eax
0047C1B6        mov         edx,esi
0047C1B8        mov         eax,ebx
0047C1BA        call        TWinControl.DoKeyPress
0047C1BF        test        al,al
0047C1C1>       jne         0047C1CC
0047C1C3        mov         edx,esi
0047C1C5        mov         eax,ebx
0047C1C7        mov         ecx,dword ptr [eax]
0047C1C9        call        dword ptr [ecx-10]
0047C1CC        pop         esi
0047C1CD        pop         ebx
0047C1CE        ret










选服务器登录 

需要配合补丁 ZC.H+24ADB4 - E8 FBAF0000           - call ZC.H+255DB4 -- 插桩
FState.TFrmDlg.DSServer1Click
0059C1F0        cmp         dword ptr [ebp-0C],0
0059C1F4>       je          0059C222

0059C1F6        mov         eax,[00679EBC];^gvar_007524B4:TFrmMain
0059C1FB        mov         eax,dword ptr [eax]
0059C1FD        mov         edx,dword ptr [ebp-0C]
0059C200        call        00642A48
0059C205        xor         edx,edx
0059C207        mov         eax,dword ptr [ebp-4]
0059C20A        mov         eax,dword ptr [eax+670];TFrmDlg.DSelServerDlg:TDWindow
0059C210        call        TDWindow.SetVisible
0059C215        mov         eax,[00679F44];^gvar_00752750:UnicodeString
0059C21A        mov         edx,dword ptr [ebp-0C]
0059C21D        call        @UStrAsg
0059C222        xor         eax,eax
0059C224        pop         edx

g serve name
[7526C0]
    ; 连接服务器
    mov         eax,[00679EBC]
    mov         eax, [eax]
    mov         edx,[007526C0]
    call        00642A48



    ; 04 00 00 00 10 62 FD 90 20 4F 47 59 // 成都传奇
    ; mov         dword ptr [edx-4], 4 
    ; mov         dword ptr [edx], 90FD6210
    ; mov         dword ptr [edx+4], 59474F20
    ; 隐藏服务器弹窗
    xor         edx,edx
    mov         eax,[0067A728];
    mov         eax, [eax]
    mov         eax,dword ptr [eax+670];TFrmDlg.DSelServerDlg:TDWindow
    call        005426D8


FState.TFrmDlg.DscSelect1Click
0059C621        cmp         eax,dword ptr [edx+63C];TFrmDlg.DscStart:TDButton

0059C629        mov         eax,[0067A018];^gvar_007524C4:TSelectChrScene
0059C62E        mov         eax,dword ptr [eax]
0059C630        call        0056D10C


渲染角色选择
mov         eax,[0067A018]
mov         eax,dword ptr [eax]
call        0056D10C

这里有一堆的相同的  DscSelect1Click

if Sender = DscSelect1 then
SelectChrScene.SelChrSelect1Click;
if Sender = DscSelect2 then
SelectChrScene.SelChrSelect2Click;
if Sender = DscStart then
SelectChrScene.SelChrStartClick;
if Sender = DscNewChr then
SelectChrScene.SelChrNewChrClick;
if Sender = DscEraseChr then
SelectChrScene.SelChrEraseChrClick;
if Sender = DscCredits then
SelectChrScene.SelChrCreditsClick;
if Sender = DscExit then
SelectChrScene.SelChrExitClick;

SelChrStartClick
ZC.H+19C627 - 75 0C                 - jne ZC.H+19C635
ZC.H+19C629 - A1 18A06700           - mov eax,[ZC.H+27A018] { (007524C4) }
ZC.H+19C62E - 8B 00                 - mov eax,[eax]
ZC.H+19C630 - E8 D70AFDFF           - call ZC.H+16D10C
ZC.H+19C635 - 8B 45 F8              - mov eax,[ebp-08]



最后的OK button 补丁跳过自动点OK

push 0
push 0
push 0
xor ecx,ecx
mov edx,3FA
mov eax,[0x7524B4]
call 0x642524

_Unit101.sub_00659828
...
006598C4        call        @UStrCatN
006598C9>       jmp         00659886
006598CB        mov         eax,[0067A728];^gvar_0074350C:TFrmDlg
006598D0        mov         eax,dword ptr [eax]
006598D2        mov         dword ptr [eax+0B14],2
006598DC        mov         byte ptr ds:[7564D8],0;gvar_007564D8
006598E3        mov         eax,[0067A728];^gvar_0074350C:TFrmDlg
006598E8        mov         eax,dword ptr [eax]
006598EA        mov         cx,word ptr ds:[65995C];0x4 gvar_0065995C
006598F1        mov         edx,dword ptr [ebp-10]
006598F4        call        0059A75C -- 对话框干掉
006598F9        dec         eax
006598FA>       jne         00659911

ZC.H+2598F4 - E8 63 0E F4 FF           - call ZC.H+19A75C
ZC.H+2598F9 - 48                    - dec eax
ZC.H+2598FA - 75 15                 - jne ZC.H+259911


006598FC        push        0
006598FE        push        0
00659900        push        0
00659902        xor         ecx,ecx
00659904        mov         edx,3FA
00659909        mov         eax,dword ptr [ebp-4]
0065990C        call        00642524






DOptionClick 暂时没用

pushad
pushfd
mov         eax,[0067A728];
mov         eax,dword ptr [eax]
call 005A30D4
popfd
popad









ZC.H+13FF8E - 8B 4D F8              - mov ecx,[ebp-08]
ZC.H+13FF91 - 8B 5D FC              - mov ebx,[ebp-04]
ZC.H+13FF94 - 8B 55 FC              - mov edx,[ebp-04]
ZC.H+13FF97 - 8B 83 9C020000        - mov eax,[ebx+0000029C]
ZC.H+13FF9D - FF 93 98020000        - call dword ptr [ebx+00000298]
Tcontrol onkeypress

pushad
pushfd
// 这里怎么申请一个
mov ecx, 752764
mov  dword ptr [ecx], 0x31
mov edx, [7432F8]
mov ebx, edx
mov eax, [ebx+0000029C]
call dword ptr [ebx+00000298]


popfd
popad
